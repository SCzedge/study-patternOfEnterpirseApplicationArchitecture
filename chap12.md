# 객체-관계형 구조패턴

## 식별자필드

## 외래 키 매핑


## 연관 테이블 매핑
- 객체는 컬랙션을 사용해 다중 값 필드를 쉽게 처리하지만 관계형 데이터베이스에는 단일값 필드만 사용할 수 있다.
- 일대다 매핑시 왜래키 매핑을 활용해 매핑을 처리할 수 있다.
- 다대다 매핑시 관계테이블을 추가로 만들어 연관테이블 매핑을 사용해 매핑하면 된다.

### 작동원리
- 링크테이블을 사용해 연관 관계를 저장한다.
- 링크 테이블은 연결된 두 테이블의 외래키 id만을 포함하며 기본키는 연관테이블의 두 기본키를 합성한것이다.
- 링크 데이터 업데이트시 링크테이블을 의존매핑처럼 취급하여 작업하면 수월하다.

### 사용시점
- 연관테이블 매핑은 다대다 연관 관계를 나타낼 수 있지만 왜래키 매핑보다 복잡하고 추가조인이 필요하므로 일반적으로 부적절하다.
- 스키마를 제어할 수 없고 기존테이블 두개를 연결하는 경우에 사용할 수 있다.
- 기존 스키마에 꼭 필요하지 않은 연관테이블이 사용되는 경우 스키마 간소화보다 쉽다.

## 의존매핑
- 연관된 객체의 데이터에 대한 매핑까지 처리하게하면 매핑절차를 간소화 할 수 있으며 이를 의존매핑 이라고 한다.

### 작동원리
- 한 클래스가 자신의 데이터베이스 지속성을 위해 다른 클래스에 의존하는하는것이 기본 개념이다.
- 의존자의 소유자는 반드시 하나여야한다.
- 식별자 필드가 없으며 식별자 맵에 저장되지않고 모든 검색은 소유자가 수행하므로 검색기도 없다. 
- 의존자가 다른 의존자를 소유할 수 있어 첫번째 의존자의 소유자는 두번째 의존자의 지속성을 담당하며 여러 의존자 계층전체를 소유자 하나가 제어 할 수 있다.
- 데이터베이스에서 소유자의 기본키를 포함하는 복합키를 기본키로 사용하면 편리하다
- UML모델에서는 소유자와 의존자간 관계는 합성으로 표시하는것이 작합하다.
- 의존자의 기록과 저장은 소유자가 담당하므로 의존자의 업데이트를 삭제와 삽입으로 해결 할 수 있으며 소유자의 컬렉션에 추가 제거된 객체를 분석하는 작업을 할 필요가 없다. 

#### 의존자 매핑 클래스
- 활성레코드와 행 데이터 게이트웨이의 경우 의존클래스는 매핑코드가 없고 해당 매핑코드는 소유자에 배치된다.
- 데이터매퍼의 경우 의존자에 대한 매퍼가 없고 해당 매핑코드는 소유자의 매퍼에 배치된다.
- 테이블 데이터 게이트웨이의 경우 일반적으로 의존클래스 자체가 없고 모든 처리가 소유자에서 수행된다.
- 거의 대부분 소유자를 로드하면 의존자도 로드되며, 의존자를 로드하는것이 부담이된다면 지연로드를 사용 할 수 있다.

### 사용시점
- 객체를 참조하는 객체가 하나일 때만 사용하며 여러 객체가 자신의 id를 가질 필요가 없는 상황에 사용하면 의존성관리가 쉬워진다.
- 의존 매핑 사용시 충족해야하는 요건
    1. 의존자의 소유자가 하나여야한다.
    2. 소유자를 제외하고는 다른객체로 부터의 참조가 없어야한다.
- 도메인 모델 설계시 엔터티 객체와 의존객체의 개념을 활용하는 설계이론이 있지만 의존그래프가 커지지 않게 주의하여야한다. 
- 작업단위 사용시에는 의존 매핑을 권장하지 않는다. 

## 포함값

## 직렬화 LOB